# é£ä¹¦é£æ ¼è‡ªåŠ¨åŒ–å·¥ä½œæµè®¾è®¡æ–¹æ¡ˆ

> åŸºäºé£ä¹¦å®¡æ‰¹å·¥ä½œæµçš„è®¾è®¡ç†å¿µï¼Œä¸º TalentMail æ‰“é€ å¯è§†åŒ–è‡ªåŠ¨åŒ–å·¥ä½œæµç³»ç»Ÿ
> æœ€åæ›´æ–°: 2026-01-02

---

## ä¸€ã€é£ä¹¦å®¡æ‰¹å·¥ä½œæµæ ¸å¿ƒç‰¹ç‚¹åˆ†æ

### 1.1 é£ä¹¦å·¥ä½œæµçš„è®¾è®¡äº®ç‚¹

| ç‰¹ç‚¹ | æè¿° | å¯¹ TalentMail çš„å¯ç¤º |
|------|------|---------------------|
| **å¯è§†åŒ–ç”»å¸ƒ** | æµç¨‹å›¾å¼çš„æ‹–æ‹½ç¼–è¾‘å™¨ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç”¨çº¿è¿æ¥ | é‡‡ç”¨ç±»ä¼¼çš„ç”»å¸ƒå¼è®¾è®¡ |
| **èŠ‚ç‚¹åŒ–è®¾è®¡** | æ¯ä¸ªæ­¥éª¤æ˜¯ä¸€ä¸ªç‹¬ç«‹èŠ‚ç‚¹ï¼ˆè§¦å‘å™¨ã€æ¡ä»¶ã€åŠ¨ä½œï¼‰ | å°†è§„åˆ™æ‹†åˆ†ä¸ºå¯ç»„åˆçš„èŠ‚ç‚¹ |
| **åˆ†æ”¯é€»è¾‘** | æ”¯æŒ IF/ELSE æ¡ä»¶åˆ†æ”¯ï¼Œèµ°ä¸åŒè·¯å¾„ | å¢åŠ æ¡ä»¶åˆ†æ”¯èŠ‚ç‚¹ |
| **å¹¶è¡Œæ‰§è¡Œ** | æ”¯æŒå¤šä¸ªåŠ¨ä½œåŒæ—¶æ‰§è¡Œ | æ·»åŠ å¹¶è¡ŒèŠ‚ç‚¹æ”¯æŒ |
| **è¡¨å•é©±åŠ¨** | åŠ¨æ€è¡¨å•é…ç½®ï¼Œå­—æ®µå¯è‡ªå®šä¹‰ | åŠ¨ä½œé…ç½®é‡‡ç”¨åŠ¨æ€è¡¨å• |
| **å®æ—¶é¢„è§ˆ** | ç¼–è¾‘æ—¶å¯é¢„è§ˆæµç¨‹æ•ˆæœ | æ·»åŠ æµç¨‹æ¨¡æ‹ŸåŠŸèƒ½ |
| **æ¨¡æ¿å¸‚åœº** | é¢„è®¾çš„å·¥ä½œæµæ¨¡æ¿ï¼Œä¸€é”®ä½¿ç”¨ | åˆ›å»ºå·¥ä½œæµæ¨¡æ¿åº“ |
| **ç‰ˆæœ¬ç®¡ç†** | æ”¯æŒç‰ˆæœ¬å›æ»šå’Œå†å²æŸ¥çœ‹ | å®ç°ç‰ˆæœ¬æ§åˆ¶ |

### 1.2 é£ä¹¦å·¥ä½œæµçš„èŠ‚ç‚¹ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é£ä¹¦å·¥ä½œæµèŠ‚ç‚¹ç±»å‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸŸ¢ è§¦å‘èŠ‚ç‚¹ (Trigger)                                           â”‚
â”‚  â”œâ”€â”€ è¡¨å•æäº¤è§¦å‘                                                â”‚
â”‚  â”œâ”€â”€ å®šæ—¶è§¦å‘                                                    â”‚
â”‚  â”œâ”€â”€ äº‹ä»¶è§¦å‘                                                    â”‚
â”‚  â””â”€â”€ Webhook è§¦å‘                                                â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”µ æ¡ä»¶èŠ‚ç‚¹ (Condition)                                         â”‚
â”‚  â”œâ”€â”€ æ¡ä»¶åˆ†æ”¯ (IF/ELSE)                                          â”‚
â”‚  â”œâ”€â”€ å¤šæ¡ä»¶åˆ†æ”¯ (SWITCH)                                         â”‚
â”‚  â””â”€â”€ å¾ªç¯èŠ‚ç‚¹ (FOR EACH)                                         â”‚
â”‚                                                                  â”‚
â”‚  ğŸŸ¡ å®¡æ‰¹èŠ‚ç‚¹ (Approval) - é£ä¹¦ç‰¹æœ‰                               â”‚
â”‚  â”œâ”€â”€ å•äººå®¡æ‰¹                                                    â”‚
â”‚  â”œâ”€â”€ å¤šäººä¼šç­¾                                                    â”‚
â”‚  â”œâ”€â”€ å¤šäººæˆ–ç­¾                                                    â”‚
â”‚  â””â”€â”€ è‡ªåŠ¨å®¡æ‰¹                                                    â”‚
â”‚                                                                  â”‚
â”‚  ğŸŸ£ åŠ¨ä½œèŠ‚ç‚¹ (Action)                                            â”‚
â”‚  â”œâ”€â”€ å‘é€æ¶ˆæ¯                                                    â”‚
â”‚  â”œâ”€â”€ å‘é€é‚®ä»¶                                                    â”‚
â”‚  â”œâ”€â”€ æ›´æ–°æ•°æ®                                                    â”‚
â”‚  â”œâ”€â”€ è°ƒç”¨ API                                                    â”‚
â”‚  â”œâ”€â”€ åˆ›å»ºä»»åŠ¡                                                    â”‚
â”‚  â””â”€â”€ è§¦å‘å…¶ä»–å·¥ä½œæµ                                              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ ç»“æŸèŠ‚ç‚¹ (End)                                               â”‚
â”‚  â”œâ”€â”€ æ­£å¸¸ç»“æŸ                                                    â”‚
â”‚  â”œâ”€â”€ æ‹’ç»ç»“æŸ                                                    â”‚
â”‚  â””â”€â”€ ç»ˆæ­¢æµç¨‹                                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€TalentMail é£ä¹¦é£æ ¼å·¥ä½œæµè®¾è®¡

### 2.1 èŠ‚ç‚¹ç±»å‹å®šä¹‰

é’ˆå¯¹é‚®ä»¶ç³»ç»Ÿåœºæ™¯ï¼Œæˆ‘ä»¬å®šä¹‰ä»¥ä¸‹èŠ‚ç‚¹ç±»å‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TalentMail å·¥ä½œæµèŠ‚ç‚¹ç±»å‹                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸŸ¢ è§¦å‘èŠ‚ç‚¹ (Trigger) - å·¥ä½œæµå…¥å£                              â”‚
â”‚  â”œâ”€â”€ ğŸ“§ æ”¶åˆ°é‚®ä»¶                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ“¤ å‘é€é‚®ä»¶                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ‘¤ ç”¨æˆ·äº‹ä»¶ï¼ˆæ³¨å†Œ/ç™»å½•/ä¿®æ”¹å¯†ç ï¼‰                           â”‚
â”‚  â”œâ”€â”€ â° å®šæ—¶è§¦å‘                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ”— Webhook è§¦å‘                                             â”‚
â”‚  â””â”€â”€ ğŸ–±ï¸ æ‰‹åŠ¨è§¦å‘                                                 â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”µ é€»è¾‘èŠ‚ç‚¹ (Logic) - æµç¨‹æ§åˆ¶                                  â”‚
â”‚  â”œâ”€â”€ ğŸ”€ æ¡ä»¶åˆ†æ”¯ (IF/ELSE)                                       â”‚
â”‚  â”œâ”€â”€ ğŸ”¢ å¤šæ¡ä»¶åˆ†æ”¯ (SWITCH)                                      â”‚
â”‚  â”œâ”€â”€ â³ å»¶è¿Ÿæ‰§è¡Œ (DELAY)                                         â”‚
â”‚  â””â”€â”€ ğŸ”„ å¹¶è¡Œæ‰§è¡Œ (PARALLEL)                                      â”‚
â”‚                                                                  â”‚
â”‚  ğŸŸ¡ é‚®ä»¶åŠ¨ä½œ (Email Actions)                                     â”‚
â”‚  â”œâ”€â”€ ğŸ“§ å‘é€é‚®ä»¶                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ“‹ å‘é€æ¨¡æ¿é‚®ä»¶                                             â”‚
â”‚  â”œâ”€â”€ â†©ï¸ å›å¤é‚®ä»¶                                                 â”‚
â”‚  â”œâ”€â”€ â¡ï¸ è½¬å‘é‚®ä»¶                                                 â”‚
â”‚  â””â”€â”€ ğŸ“ æ·»åŠ é™„ä»¶                                                 â”‚
â”‚                                                                  â”‚
â”‚  ğŸŸ£ é‚®ä»¶å¤„ç† (Email Operations)                                  â”‚
â”‚  â”œâ”€â”€ ğŸ“ ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹                                             â”‚
â”‚  â”œâ”€â”€ ğŸ·ï¸ æ·»åŠ /ç§»é™¤æ ‡ç­¾                                            â”‚
â”‚  â”œâ”€â”€ â­ æ ‡è®°æ˜Ÿæ ‡                                                  â”‚
â”‚  â”œâ”€â”€ âœ… æ ‡è®°å·²è¯»                                                  â”‚
â”‚  â”œâ”€â”€ ğŸ—‘ï¸ åˆ é™¤é‚®ä»¶                                                 â”‚
â”‚  â””â”€â”€ ğŸ“¦ å½’æ¡£é‚®ä»¶                                                 â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”´ é›†æˆåŠ¨ä½œ (Integrations)                                      â”‚
â”‚  â”œâ”€â”€ ğŸŒ Webhook è°ƒç”¨                                             â”‚
â”‚  â”œâ”€â”€ ğŸ“ è®°å½•æ—¥å¿—                                                 â”‚
â”‚  â”œâ”€â”€ ğŸ”” å‘é€é€šçŸ¥                                                 â”‚
â”‚  â””â”€â”€ âš¡ è§¦å‘å…¶ä»–å·¥ä½œæµ                                           â”‚
â”‚                                                                  â”‚
â”‚  âš« ç»“æŸèŠ‚ç‚¹ (End)                                               â”‚
â”‚  â”œâ”€â”€ âœ… æˆåŠŸç»“æŸ                                                 â”‚
â”‚  â””â”€â”€ âŒ å¤±è´¥ç»“æŸ                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¯è§†åŒ–ç”»å¸ƒè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ å·¥ä½œæµç¼–è¾‘å™¨                                    [ä¿å­˜] [æµ‹è¯•] [å‘å¸ƒ]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    â”‚                                                        â”‚
â”‚  ğŸ“¦ èŠ‚ç‚¹é¢æ¿        â”‚                    ç”»å¸ƒåŒºåŸŸ                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                                                        â”‚
â”‚                    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â–¼ è§¦å‘å™¨          â”‚     â”‚  ğŸŸ¢ è§¦å‘å™¨   â”‚                                    â”‚
â”‚    ğŸ“§ æ”¶åˆ°é‚®ä»¶     â”‚     â”‚  ç”¨æˆ·æ³¨å†Œ    â”‚                                    â”‚
â”‚    ğŸ‘¤ ç”¨æˆ·äº‹ä»¶     â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚    â° å®šæ—¶è§¦å‘     â”‚            â”‚                                           â”‚
â”‚                    â”‚            â–¼                                           â”‚
â”‚  â–¼ é€»è¾‘æ§åˆ¶        â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚    ğŸ”€ æ¡ä»¶åˆ†æ”¯     â”‚     â”‚  ğŸ”µ æ¡ä»¶     â”‚                                    â”‚
â”‚    â³ å»¶è¿Ÿ         â”‚     â”‚ é‚®ç®±å«@vip  â”‚                                    â”‚
â”‚    ğŸ”„ å¹¶è¡Œ         â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚        â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                       â”‚
â”‚  â–¼ é‚®ä»¶åŠ¨ä½œ        â”‚        â”‚       â”‚                                       â”‚
â”‚    ğŸ“‹ å‘é€æ¨¡æ¿     â”‚    æ˜¯ â–¼       â–¼ å¦                                     â”‚
â”‚    â†©ï¸ å›å¤         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚    â¡ï¸ è½¬å‘         â”‚  â”‚ğŸŸ¡VIPæ¨¡æ¿â”‚ â”‚ğŸŸ¡æ™®é€šæ¨¡æ¿â”‚                                â”‚
â”‚                    â”‚  â”‚ å‘é€   â”‚ â”‚  å‘é€   â”‚                                 â”‚
â”‚  â–¼ é‚®ä»¶å¤„ç†        â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                                 â”‚
â”‚    ğŸ“ ç§»åŠ¨æ–‡ä»¶å¤¹   â”‚      â”‚           â”‚                                     â”‚
â”‚    ğŸ·ï¸ æ·»åŠ æ ‡ç­¾     â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚    â­ æ˜Ÿæ ‡         â”‚            â”‚                                           â”‚
â”‚                    â”‚            â–¼                                           â”‚
â”‚  â–¼ é›†æˆ           â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚    ğŸŒ Webhook     â”‚     â”‚  ğŸŸ£ æ·»åŠ æ ‡ç­¾ â”‚                                    â”‚
â”‚    ğŸ“ æ—¥å¿—        â”‚     â”‚   æ–°ç”¨æˆ·     â”‚                                    â”‚
â”‚                    â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚            â”‚                                           â”‚
â”‚                    â”‚            â–¼                                           â”‚
â”‚                    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚     â”‚  âš« ç»“æŸ    â”‚                                    â”‚
â”‚                    â”‚     â”‚   æˆåŠŸ      â”‚                                    â”‚
â”‚                    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èŠ‚ç‚¹é…ç½®é¢æ¿ï¼ˆé€‰ä¸­èŠ‚ç‚¹æ—¶æ˜¾ç¤ºï¼‰                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“‹ å‘é€æ¨¡æ¿é‚®ä»¶                                                        â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚  æ¨¡æ¿ï¼š[æ¬¢è¿é‚®ä»¶ - VIPç‰ˆ â–¼]                                            â”‚ â”‚
â”‚  â”‚  å‘é€ç»™ï¼šâ— è§¦å‘ç”¨æˆ·  â—‹ æŒ‡å®šé‚®ç®±  â—‹ ç®¡ç†å‘˜                              â”‚ â”‚
â”‚  â”‚  å˜é‡è¦†ç›–ï¼š                                                             â”‚ â”‚
â”‚  â”‚    user_name: [ä½¿ç”¨è§¦å‘æ•°æ® â–¼]                                         â”‚ â”‚
â”‚  â”‚    vip_level: [è‡ªå®šä¹‰å€¼: é»„é‡‘ä¼šå‘˜]                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¡ä»¶åˆ†æ”¯èŠ‚ç‚¹è¯¦ç»†è®¾è®¡

é£ä¹¦çš„æ¡ä»¶åˆ†æ”¯éå¸¸ç›´è§‚ï¼Œæˆ‘ä»¬é‡‡ç”¨ç±»ä¼¼è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”€ æ¡ä»¶åˆ†æ”¯é…ç½®                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  åˆ†æ”¯ 1: VIP ç”¨æˆ·                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å½“ [user_email â–¼] [åŒ…å« â–¼] [@vip.com          ]             â”‚ â”‚
â”‚  â”‚  å¹¶ä¸” [subscription â–¼] [ä¸ç­‰äº â–¼] [free           ]          â”‚ â”‚
â”‚  â”‚                                            [+ æ·»åŠ æ¡ä»¶]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  åˆ†æ”¯ 2: ä¼ä¸šç”¨æˆ·                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å½“ [user_email â–¼] [åŒ…å« â–¼] [@company.com      ]             â”‚ â”‚
â”‚  â”‚                                            [+ æ·»åŠ æ¡ä»¶]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  [+ æ·»åŠ åˆ†æ”¯]                                                    â”‚
â”‚                                                                  â”‚
â”‚  é»˜è®¤åˆ†æ”¯ï¼ˆä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶ï¼‰:                                 â”‚
â”‚  â— æ‰§è¡Œé»˜è®¤åŠ¨ä½œ  â—‹ è·³è¿‡åç»­èŠ‚ç‚¹                                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ•°æ®åº“æ¶æ„è®¾è®¡

### 3.1 èŠ‚ç‚¹å®šä¹‰è¡¨

```sql
-- å·¥ä½œæµå®šä¹‰è¡¨
CREATE TABLE workflows (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    owner_id INTEGER REFERENCES users(id),
    scope VARCHAR(20) DEFAULT 'system',      -- system/personal
    category VARCHAR(50),                    -- åˆ†ç±»
    
    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'draft',      -- draft/published/disabled
    is_active BOOLEAN DEFAULT FALSE,
    
    -- ç‰ˆæœ¬æ§åˆ¶
    version INTEGER DEFAULT 1,
    published_version INTEGER,
    
    -- ç»Ÿè®¡
    execution_count INTEGER DEFAULT 0,
    last_executed_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- å·¥ä½œæµèŠ‚ç‚¹è¡¨
CREATE TABLE workflow_nodes (
    id SERIAL PRIMARY KEY,
    workflow_id INTEGER REFERENCES workflows(id) ON DELETE CASCADE,
    
    -- èŠ‚ç‚¹ä¿¡æ¯
    node_id VARCHAR(50) NOT NULL,            -- å‰ç«¯ç”Ÿæˆçš„å”¯ä¸€ ID
    node_type VARCHAR(50) NOT NULL,          -- trigger/condition/action/end
    node_subtype VARCHAR(50) NOT NULL,       -- email_received/send_template/etc
    name VARCHAR(100),
    
    -- ä½ç½®ä¿¡æ¯ï¼ˆç”»å¸ƒåæ ‡ï¼‰
    position_x INTEGER DEFAULT 0,
    position_y INTEGER DEFAULT 0,
    
    -- é…ç½®
    config JSONB DEFAULT '{}',
    
    -- æ’åº
    sort_order INTEGER DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(workflow_id, node_id)
);

-- å·¥ä½œæµè¿æ¥è¡¨ï¼ˆèŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿ï¼‰
CREATE TABLE workflow_edges (
    id SERIAL PRIMARY KEY,
    workflow_id INTEGER REFERENCES workflows(id) ON DELETE CASCADE,
    
    -- è¿æ¥ä¿¡æ¯
    edge_id VARCHAR(50) NOT NULL,            -- å‰ç«¯ç”Ÿæˆçš„å”¯ä¸€ ID
    source_node_id VARCHAR(50) NOT NULL,     -- æºèŠ‚ç‚¹ ID
    target_node_id VARCHAR(50) NOT NULL,     -- ç›®æ ‡èŠ‚ç‚¹ ID
    source_handle VARCHAR(50),               -- æºèŠ‚ç‚¹çš„è¾“å‡ºç«¯å£
    target_handle VARCHAR(50),               -- ç›®æ ‡èŠ‚ç‚¹çš„è¾“å…¥ç«¯å£
    
    -- æ¡ä»¶åˆ†æ”¯æ—¶çš„æ ‡ç­¾
    label VARCHAR(100),                      -- å¦‚ "æ˜¯" / "å¦"
    condition_key VARCHAR(50),               -- æ¡ä»¶é”®ï¼Œå¦‚ "branch_1"
    
    created_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(workflow_id, edge_id)
);

-- èŠ‚ç‚¹ç±»å‹å®šä¹‰è¡¨
CREATE TABLE node_types (
    id SERIAL PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,        -- email_received/send_template
    name VARCHAR(100) NOT NULL,              -- æ”¶åˆ°é‚®ä»¶/å‘é€æ¨¡æ¿é‚®ä»¶
    name_en VARCHAR(100),
    category VARCHAR(50) NOT NULL,           -- trigger/logic/email_action/etc
    icon VARCHAR(50),                        -- emoji æˆ–å›¾æ ‡å
    color VARCHAR(20),                       -- èŠ‚ç‚¹é¢œè‰²
    description TEXT,
    
    -- ç«¯å£å®šä¹‰
    input_ports JSONB DEFAULT '[]',          -- è¾“å…¥ç«¯å£
    output_ports JSONB DEFAULT '[]',         -- è¾“å‡ºç«¯å£
    
    -- é…ç½® Schema
    config_schema JSONB,                     -- JSON Schema
    
    -- å¯ç”¨å˜é‡
    available_variables JSONB,
    output_variables JSONB,
    
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- å·¥ä½œæµæ‰§è¡Œæ—¥å¿—è¡¨
CREATE TABLE workflow_executions (
    id SERIAL PRIMARY KEY,
    workflow_id INTEGER REFERENCES workflows(id),
    version INTEGER,
    
    -- è§¦å‘ä¿¡æ¯
    trigger_type VARCHAR(50),
    trigger_data JSONB,
    
    -- æ‰§è¡ŒçŠ¶æ€
    status VARCHAR(20),                      -- running/success/failed/cancelled
    started_at TIMESTAMP DEFAULT NOW(),
    finished_at TIMESTAMP,
    
    -- æ‰§è¡Œç»“æœ
    result JSONB,
    error_message TEXT
);

-- èŠ‚ç‚¹æ‰§è¡Œæ—¥å¿—è¡¨
CREATE TABLE workflow_node_executions (
    id SERIAL PRIMARY KEY,
    execution_id INTEGER REFERENCES workflow_executions(id) ON DELETE CASCADE,
    node_id VARCHAR(50) NOT NULL,
    
    -- æ‰§è¡Œä¿¡æ¯
    started_at TIMESTAMP,
    finished_at TIMESTAMP,
    status VARCHAR(20),                      -- pending/running/success/failed/skipped
    
    -- è¾“å…¥è¾“å‡º
    input_data JSONB,
    output_data JSONB,
    error_message TEXT
);
```

### 3.2 åˆå§‹èŠ‚ç‚¹ç±»å‹æ•°æ®

```sql
-- è§¦å‘å™¨èŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, config_schema) VALUES
('trigger_email_received', 'æ”¶åˆ°é‚®ä»¶', 'trigger', 'ğŸ“§', '{
  "type": "object",
  "properties": {
    "filter_sender": {"type": "string", "title": "å‘ä»¶äººè¿‡æ»¤"},
    "filter_subject": {"type": "string", "title": "ä¸»é¢˜è¿‡æ»¤"}
  }
}'),
('trigger_user_event', 'ç”¨æˆ·äº‹ä»¶', 'trigger', 'ğŸ‘¤', '{
  "type": "object",
  "properties": {
    "event_type": {
      "type": "string",
      "title": "äº‹ä»¶ç±»å‹",
      "enum": ["user.registered", "user.login", "user.password_changed"],
      "enumNames": ["ç”¨æˆ·æ³¨å†Œ", "ç”¨æˆ·ç™»å½•", "å¯†ç ä¿®æ”¹"]
    }
  },
  "required": ["event_type"]
}'),
('trigger_scheduled', 'å®šæ—¶è§¦å‘', 'trigger', 'â°', '{
  "type": "object",
  "properties": {
    "cron": {"type": "string", "title": "Cron è¡¨è¾¾å¼"},
    "timezone": {"type": "string", "title": "æ—¶åŒº", "default": "Asia/Shanghai"}
  },
  "required": ["cron"]
}'),
('trigger_webhook', 'Webhook è§¦å‘', 'trigger', 'ğŸ”—', '{
  "type": "object",
  "properties": {
    "secret": {"type": "string", "title": "éªŒè¯å¯†é’¥"}
  }
}'),
('trigger_manual', 'æ‰‹åŠ¨è§¦å‘', 'trigger', 'ğŸ–±ï¸', '{}');

-- é€»è¾‘èŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, output_ports, config_schema) VALUES
('logic_condition', 'æ¡ä»¶åˆ†æ”¯', 'logic', 'ğŸ”€', 
 '[{"id": "true", "label": "æ˜¯"}, {"id": "false", "label": "å¦"}]',
 '{
  "type": "object",
  "properties": {
    "conditions": {
      "type": "array",
      "title": "æ¡ä»¶åˆ—è¡¨",
      "items": {
        "type": "object",
        "properties": {
          "field": {"type": "string"},
          "operator": {"type": "string"},
          "value": {"type": "string"}
        }
      }
    }
  }
}'),
('logic_switch', 'å¤šæ¡ä»¶åˆ†æ”¯', 'logic', 'ğŸ”¢', '[]', '{
  "type": "object",
  "properties": {
    "branches": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "conditions": {"type": "array"}
        }
      }
    }
  }
}'),
('logic_delay', 'å»¶è¿Ÿæ‰§è¡Œ', 'logic', 'â³', '[]', '{
  "type": "object",
  "properties": {
    "delay_value": {"type": "integer", "title": "å»¶è¿Ÿæ—¶é—´", "default": 5},
    "delay_unit": {
      "type": "string", 
      "title": "æ—¶é—´å•ä½",
      "enum": ["seconds", "minutes", "hours", "days"],
      "default": "minutes"
    }
  }
}'),
('logic_parallel', 'å¹¶è¡Œæ‰§è¡Œ', 'logic', 'ğŸ”„', '[]', '{}');

-- é‚®ä»¶åŠ¨ä½œèŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, config_schema) VALUES
('action_send_email', 'å‘é€é‚®ä»¶', 'email_action', 'ğŸ“§', '{
  "type": "object",
  "properties": {
    "to": {"type": "string", "title": "æ”¶ä»¶äºº"},
    "subject": {"type": "string", "title": "ä¸»é¢˜"},
    "body": {"type": "string", "title": "æ­£æ–‡", "format": "html"}
  },
  "required": ["to", "subject", "body"]
}'),
('action_send_template', 'å‘é€æ¨¡æ¿é‚®ä»¶', 'email_action', 'ğŸ“‹', '{
  "type": "object",
  "properties": {
    "template_code": {"type": "string", "title": "æ¨¡æ¿"},
    "to_type": {
      "type": "string",
      "title": "å‘é€ç»™",
      "enum": ["trigger_user", "fixed_email", "admin"],
      "enumNames": ["è§¦å‘ç”¨æˆ·", "æŒ‡å®šé‚®ç®±", "ç®¡ç†å‘˜"]
    },
    "to_email": {"type": "string", "title": "æ”¶ä»¶äººé‚®ç®±"},
    "variables": {"type": "object", "title": "å˜é‡è¦†ç›–"}
  },
  "required": ["template_code", "to_type"]
}'),
('action_reply', 'å›å¤é‚®ä»¶', 'email_action', 'â†©ï¸', '{
  "type": "object",
  "properties": {
    "body": {"type": "string", "title": "å›å¤å†…å®¹", "format": "html"}
  },
  "required": ["body"]
}'),
('action_forward', 'è½¬å‘é‚®ä»¶', 'email_action', 'â¡ï¸', '{
  "type": "object",
  "properties": {
    "to": {"type": "string", "title": "è½¬å‘ç»™"}
  },
  "required": ["to"]
}');

-- é‚®ä»¶å¤„ç†èŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, config_schema) VALUES
('operation_move_folder', 'ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹', 'email_operation', 'ğŸ“', '{
  "type": "object",
  "properties": {
    "folder": {"type": "string", "title": "ç›®æ ‡æ–‡ä»¶å¤¹"}
  },
  "required": ["folder"]
}'),
('operation_add_tag', 'æ·»åŠ æ ‡ç­¾', 'email_operation', 'ğŸ·ï¸', '{
  "type": "object",
  "properties": {
    "tag": {"type": "string", "title": "æ ‡ç­¾å"}
  },
  "required": ["tag"]
}'),
('operation_mark_starred', 'æ ‡è®°æ˜Ÿæ ‡', 'email_operation', 'â­', '{}'),
('operation_mark_read', 'æ ‡è®°å·²è¯»', 'email_operation', 'âœ…', '{}'),
('operation_delete', 'åˆ é™¤é‚®ä»¶', 'email_operation', 'ğŸ—‘ï¸', '{}'),
('operation_archive', 'å½’æ¡£é‚®ä»¶', 'email_operation', 'ğŸ“¦', '{}');

-- é›†æˆèŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, config_schema) VALUES
('integration_webhook', 'Webhook è°ƒç”¨', 'integration', 'ğŸŒ', '{
  "type": "object",
  "properties": {
    "url": {"type": "string", "title": "URL"},
    "method": {"type": "string", "enum": ["GET", "POST", "PUT", "DELETE"]},
    "headers": {"type": "object"},
    "body": {"type": "object"}
  },
  "required": ["url", "method"]
}'),
('integration_log', 'è®°å½•æ—¥å¿—', 'integration', 'ğŸ“', '{
  "type": "object",
  "properties": {
    "message": {"type": "string", "title": "æ—¥å¿—å†…å®¹"},
    "level": {"type": "string", "enum": ["info", "warning", "error"]}
  }
}'),
('integration_trigger_workflow', 'è§¦å‘å…¶ä»–å·¥ä½œæµ', 'integration', 'âš¡', '{
  "type": "object",
  "properties": {
    "workflow_id": {"type": "integer", "title": "ç›®æ ‡å·¥ä½œæµ"},
    "pass_data": {"type": "boolean", "title": "ä¼ é€’å½“å‰æ•°æ®"}
  }
}');

-- ç»“æŸèŠ‚ç‚¹
INSERT INTO node_types (code, name, category, icon, config_schema) VALUES
('end_success', 'æˆåŠŸç»“æŸ', 'end', 'âœ…', '{}'),
('end_failure', 'å¤±è´¥ç»“æŸ', 'end', 'âŒ', '{
  "type": "object",
  "properties": {
    "error_message": {"type": "string", "title": "é”™è¯¯ä¿¡æ¯"}
  }
}');
```

---

## å››ã€å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ

### 4.1 æŠ€æœ¯é€‰å‹

é‡‡ç”¨ **Vue Flow** ä½œä¸ºç”»å¸ƒå¼•æ“ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº Vue 3 çš„æµç¨‹å›¾åº“ï¼š

```bash
npm install @vue-flow/core @vue-flow/background @vue-flow/controls @vue-flow/minimap
```

### 4.2 æ ¸å¿ƒç»„ä»¶ç»“æ„

```
frontend/app/components/workflow/
â”œâ”€â”€ WorkflowEditor.vue        # ä¸»ç¼–è¾‘å™¨ç»„ä»¶
â”œâ”€â”€ WorkflowCanvas.vue        # ç”»å¸ƒç»„ä»¶ï¼ˆä½¿ç”¨ Vue Flowï¼‰
â”œâ”€â”€ NodePalette.vue           # å·¦ä¾§èŠ‚ç‚¹é¢æ¿
â”œâ”€â”€ NodeConfig.vue            # å³ä¾§èŠ‚ç‚¹é…ç½®é¢æ¿
â”œâ”€â”€ nodes/                    # è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶
â”‚   â”œâ”€â”€ TriggerNode.vue       # è§¦å‘å™¨èŠ‚ç‚¹
â”‚   â”œâ”€â”€ ConditionNode.vue     # æ¡ä»¶èŠ‚ç‚¹
â”‚   â”œâ”€â”€ ActionNode.vue        # åŠ¨ä½œèŠ‚ç‚¹
â”‚   â””â”€â”€ EndNode.vue           # ç»“æŸèŠ‚ç‚¹
â”œâ”€â”€ forms/                    # åŠ¨æ€é…ç½®è¡¨å•
â”‚   â”œâ”€â”€ DynamicForm.vue       # æ ¹æ® JSON Schema ç”Ÿæˆè¡¨å•
â”‚   â”œâ”€â”€ TemplateSelect.vue    # æ¨¡æ¿é€‰æ‹©å™¨
â”‚   â””â”€â”€ VariableInput.vue     # å˜é‡è¾“å…¥æ¡†
â””â”€â”€ modals/
    â”œâ”€â”€ TestWorkflowModal.vue # æµ‹è¯•å·¥ä½œæµå¼¹çª—
    â””â”€â”€ VersionHistoryModal.vue # ç‰ˆæœ¬å†å²å¼¹çª—
```

### 4.3 WorkflowCanvas ç»„ä»¶ç¤ºä¾‹

```vue
<template>
  <VueFlow
    v-model="elements"
    :node-types="nodeTypes"
    :connection-mode="ConnectionMode.Loose"
    @connect="onConnect"
    @node-click="onNodeClick"
    class="workflow-canvas"
  >
    <Background />
    <Controls />
    <MiniMap />
    
    <!-- è‡ªå®šä¹‰è¿æ¥çº¿æ ·å¼ -->
    <template #edge-default="{ sourceX, sourceY, targetX, targetY }">
      <path
        :d="getSmoothStepPath({ sourceX, sourceY, targetX, targetY })"
        class="edge-path"
      />
    </template>
  </VueFlow>
</template>

<script setup>
import { VueFlow, useVueFlow } from '@vue-flow/core'
import { Background } from '@vue-flow/background'
import { Controls } from '@vue-flow/controls'
import { MiniMap } from '@vue-flow/minimap'

import TriggerNode from './nodes/TriggerNode.vue'
import ConditionNode from './nodes/ConditionNode.vue'
import ActionNode from './nodes/ActionNode.vue'
import EndNode from './nodes/EndNode.vue'

const nodeTypes = {
  trigger: TriggerNode,
  condition: ConditionNode,
  action: ActionNode,
  end: EndNode,
}

const elements = ref([])

const onConnect = (params) => {
  // å¤„ç†èŠ‚ç‚¹è¿æ¥
}

const onNodeClick = (event, node) => {
  // ç‚¹å‡»èŠ‚ç‚¹æ—¶æ˜¾ç¤ºé…ç½®é¢æ¿
  emit('select-node', node)
}
</script>
```

### 4.4 è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶ç¤ºä¾‹

```vue
<!-- TriggerNode.vue -->
<template>
  <div 
    class="workflow-node trigger-node"
    :class="{ selected: selected }"
  >
    <div class="node-header">
      <span class="node-icon">{{ nodeData.icon }}</span>
      <span class="node-title">{{ nodeData.name }}</span>
    </div>
    <div class="node-body">
      <div class="node-description">
        {{ nodeData.description || 'ç‚¹å‡»é…ç½®è§¦å‘æ¡ä»¶' }}
      </div>
    </div>
    
    <!-- è¾“å‡ºç«¯å£ -->
    <Handle type="source" position="bottom" />
  </div>
</template>

<script setup>
import { Handle } from '@vue-flow/core'

const props = defineProps({
  data: Object,
  selected: Boolean,
})

const nodeData = computed(() => props.data || {})
</script>

<style scoped>
.trigger-node {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border-radius: 12px;
  padding: 12px 16px;
  min-width: 180px;
  color: white;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.trigger-node.selected {
  box-shadow: 0 0 0 2px #fff, 0 0 0 4px #10b981;
}
</style>
```

---

## äº”ã€API è®¾è®¡

### 5.1 å·¥ä½œæµ CRUD

```yaml
# å·¥ä½œæµç®¡ç†
GET    /api/workflows                      # è·å–å·¥ä½œæµåˆ—è¡¨
POST   /api/workflows                      # åˆ›å»ºå·¥ä½œæµ
GET    /api/workflows/{id}                 # è·å–å·¥ä½œæµè¯¦æƒ…ï¼ˆå«èŠ‚ç‚¹å’Œè¿æ¥ï¼‰
PUT    /api/workflows/{id}                 # æ›´æ–°å·¥ä½œæµ
DELETE /api/workflows/{id}                 # åˆ é™¤å·¥ä½œæµ
POST   /api/workflows/{id}/publish         # å‘å¸ƒå·¥ä½œæµ
POST   /api/workflows/{id}/disable         # ç¦ç”¨å·¥ä½œæµ
POST   /api/workflows/{id}/duplicate       # å¤åˆ¶å·¥ä½œæµ

# å·¥ä½œæµç‰ˆæœ¬
GET    /api/workflows/{id}/versions        # è·å–ç‰ˆæœ¬å†å²
POST   /api/workflows/{id}/rollback/{ver}  # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬

# å·¥ä½œæµæµ‹è¯•
POST   /api/workflows/{id}/test            # æµ‹è¯•æ‰§è¡Œ
GET    /api/workflows/{id}/test-data       # è·å–æµ‹è¯•æ•°æ®æ¨¡æ¿

# å·¥ä½œæµæ‰§è¡Œ
POST   /api/workflows/{id}/execute         # æ‰‹åŠ¨æ‰§è¡Œ
GET    /api/workflows/{id}/executions      # è·å–æ‰§è¡Œå†å²
GET    /api/workflow-executions/{id}       # è·å–æ‰§è¡Œè¯¦æƒ…

# èŠ‚ç‚¹ç±»å‹
GET    /api/workflows/node-types           # è·å–æ‰€æœ‰èŠ‚ç‚¹ç±»å‹
GET    /api/workflows/node-types/{code}    # è·å–èŠ‚ç‚¹ç±»å‹è¯¦æƒ…
```

### 5.2 è¯·æ±‚/å“åº”ç¤ºä¾‹

```json
// POST /api/workflows
{
  "name": "æ–°ç”¨æˆ·æ¬¢è¿æµç¨‹",
  "description": "ç”¨æˆ·æ³¨å†Œåè‡ªåŠ¨å‘é€æ¬¢è¿é‚®ä»¶",
  "nodes": [
    {
      "node_id": "trigger_1",
      "node_type": "trigger",
      "node_subtype": "trigger_user_event",
      "name": "ç”¨æˆ·æ³¨å†Œ",
      "position_x": 100,
      "position_y": 50,
      "config": {
        "event_type": "user.registered"
      }
    },
    {
      "node_id": "action_1",
      "node_type": "action",
      "node_subtype": "action_send_template",
      "name": "å‘é€æ¬¢è¿é‚®ä»¶",
      "position_x": 100,
      "position_y": 200,
      "config": {
        "template_code": "welcome_email",
        "to_type": "trigger_user"
      }
    },
    {
      "node_id": "end_1",
      "node_type": "end",
      "node_subtype": "end_success",
      "name": "å®Œæˆ",
      "position_x": 100,
      "position_y": 350,
      "config": {}
    }
  ],
  "edges": [
    {
      "edge_id": "edge_1",
      "source_node_id": "trigger_1",
      "target_node_id": "action_1"
    },
    {
      "edge_id": "edge_2",
      "source_node_id": "action_1",
      "target_node_id": "end_1"
    }
  ]
}
```

---

## å…­ã€å·¥ä½œæµå¼•æ“è®¾è®¡

### 6.1 æ‰§è¡Œå¼•æ“æ ¸å¿ƒé€»è¾‘

```python
# backend/core/workflow_engine.py

class WorkflowEngine:
    """é£ä¹¦é£æ ¼çš„å·¥ä½œæµæ‰§è¡Œå¼•æ“"""
    
    def __init__(self, db: Session):
        self.db = db
        self.node_handlers = self._register_handlers()
    
    async def execute(
        self, 
        workflow_id: int, 
        trigger_data: Dict,
        user: Optional[User] = None
    ) -> WorkflowExecution:
        """æ‰§è¡Œå·¥ä½œæµ"""
        
        # 1. åŠ è½½å·¥ä½œæµå®šä¹‰
        workflow = self._load_workflow(workflow_id)
        
        # 2. åˆ›å»ºæ‰§è¡Œè®°å½•
        execution = WorkflowExecution(
            workflow_id=workflow_id,
            version=workflow.version,
            trigger_data=trigger_data,
            status="running"
        )
        self.db.add(execution)
        self.db.flush()
        
        # 3. æ„å»ºæ‰§è¡Œå›¾
        graph = self._build_execution_graph(workflow)
        
        # 4. æ‰¾åˆ°è§¦å‘èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ
        trigger_node = self._find_trigger_node(graph)
        
        # 5. æ‰§è¡Œæµç¨‹
        context = ExecutionContext(
            data=trigger_data,
            user=user,
            execution_id=execution.id
        )
        
        try:
            await self._execute_node(trigger_node, graph, context)
            execution.status = "success"
        except Exception as e:
            execution.status = "failed"
            execution.error_message = str(e)
        
        execution.finished_at = datetime.utcnow()
        self.db.commit()
        
        return execution
    
    async def _execute_node(
        self, 
        node: WorkflowNode, 
        graph: Dict, 
        context: ExecutionContext
    ):
        """æ‰§è¡Œå•ä¸ªèŠ‚ç‚¹"""
        
        # è®°å½•èŠ‚ç‚¹æ‰§è¡Œå¼€å§‹
        node_execution = WorkflowNodeExecution(
            execution_id=context.execution_id,
            node_id=node.node_id,
            started_at=datetime.utcnow(),
            status="running",
            input_data=context.data
        )
        self.db.add(node_execution)
        
        try:
            # è·å–èŠ‚ç‚¹å¤„ç†å™¨
            handler = self.node_handlers.get(node.node_subtype)
            if not handler:
                raise ValueError(f"Unknown node type: {node.node_subtype}")
            
            # æ‰§è¡ŒèŠ‚ç‚¹
            result = await handler(node.config, context)
            
            # è®°å½•æ‰§è¡Œç»“æœ
            node_execution.status = "success"
            node_execution.output_data = result
            node_execution.finished_at = datetime.utcnow()
            
            # æ›´æ–°ä¸Šä¸‹æ–‡
            context.data.update(result.get("output", {}))
            
            # ç¡®å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            next_nodes = self._get_next_nodes(node, graph, result)
            
            # æ‰§è¡Œåç»­èŠ‚ç‚¹
            for next_node in next_nodes:
                await self._execute_node(next_node, graph, context)
                
        except Exception as e:
            node_execution.status = "failed"
            node_execution.error_message = str(e)
            node_execution.finished_at = datetime.utcnow()
            raise
    
    def _get_next_nodes(
        self, 
        current_node: WorkflowNode, 
        graph: Dict,
        result: Dict
    ) -> List[WorkflowNode]:
        """è·å–ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹"""
        
        edges = graph["edges"].get(current_node.node_id, [])
        
        if current_node.node_subtype == "logic_condition":
            # æ¡ä»¶èŠ‚ç‚¹ï¼šæ ¹æ®ç»“æœé€‰æ‹©åˆ†æ”¯
            branch = "true" if result.get("condition_met") else "false"
            for edge in edges:
                if edge.source_handle == branch:
                    return [graph["nodes"][edge.target_node_id]]
            return []
        
        elif current_node.node_subtype == "logic_parallel":
            # å¹¶è¡ŒèŠ‚ç‚¹ï¼šè¿”å›æ‰€æœ‰åç»­èŠ‚ç‚¹
            return [graph["nodes"][edge.target_node_id] for edge in edges]
        
        else:
            # æ™®é€šèŠ‚ç‚¹ï¼šè¿”å›ç¬¬ä¸€ä¸ªåç»­èŠ‚ç‚¹
            if edges:
                return [graph["nodes"][edges[0].target_node_id]]
            return []
```

### 6.2 èŠ‚ç‚¹å¤„ç†å™¨æ³¨å†Œ

```python
def _register_handlers(self) -> Dict[str, Callable]:
    """æ³¨å†ŒèŠ‚ç‚¹å¤„ç†å™¨"""
    return {
        # è§¦å‘å™¨
        "trigger_email_received": self._handle_trigger_email,
        "trigger_user_event": self._handle_trigger_user_event,
        "trigger_scheduled": self._handle_trigger_scheduled,
        "trigger_webhook": self._handle_trigger_webhook,
        "trigger_manual": self._handle_trigger_manual,
        
        # é€»è¾‘
        "logic_condition": self._handle_condition,
        "logic_switch": self._handle_switch,
        "logic_delay": self._handle_delay,
        "logic_parallel": self._handle_parallel,
        
        # é‚®ä»¶åŠ¨ä½œ
        "action_send_email": self._handle_send_email,
        "action_send_template": self._handle_send_template,
        "action_reply": self._handle_reply,
        "action_forward": self._handle_forward,
        
        # é‚®ä»¶å¤„ç†
        "operation_move_folder": self._handle_move_folder,
        "operation_add_tag": self._handle_add_tag,
        "operation_mark_starred": self._handle_mark_starred,
        "operation_mark_read": self._handle_mark_read,
        "operation_delete": self._handle_delete,
        "operation_archive": self._handle_archive,
        
        # é›†æˆ
        "integration_webhook": self._handle_webhook,
        "integration_log": self._handle_log,
        "integration_trigger_workflow": self._handle_trigger_workflow,
        
        # ç»“æŸ
        "end_success": self._handle_end_success,
        "end_failure": self._handle_end_failure,
    }
```

---

## ä¸ƒã€å®æ–½è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ï¼ˆ1å‘¨ï¼‰

- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»ï¼ˆworkflows, workflow_nodes, workflow_edges, node_typesï¼‰
- [ ] å®ç°å·¥ä½œæµ CRUD API
- [ ] åˆå§‹åŒ–èŠ‚ç‚¹ç±»å‹æ•°æ®
- [ ] åˆ›å»º WorkflowEngine åŸºç¡€æ¡†æ¶

### é˜¶æ®µäºŒï¼šå‰ç«¯ç”»å¸ƒï¼ˆ2å‘¨ï¼‰

- [ ] é›†æˆ Vue Flow
- [ ] å®ç°èŠ‚ç‚¹é¢æ¿ï¼ˆæ‹–æ‹½ï¼‰
- [ ] å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶
- [ ] å®ç°èŠ‚ç‚¹é…ç½®é¢æ¿ï¼ˆåŠ¨æ€è¡¨å•ï¼‰
- [ ] å®ç°ä¿å­˜/åŠ è½½å·¥ä½œæµ

### é˜¶æ®µä¸‰ï¼šèŠ‚ç‚¹å¤„ç†å™¨ï¼ˆ1å‘¨ï¼‰

- [ ] å®ç°æ‰€æœ‰è§¦å‘å™¨å¤„ç†å™¨
- [ ] å®ç°æ¡ä»¶/åˆ†æ”¯å¤„ç†å™¨
- [ ] å®ç°é‚®ä»¶åŠ¨ä½œå¤„ç†å™¨
- [ ] å®ç°é›†æˆåŠ¨ä½œå¤„ç†å™¨

### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

- [ ] å·¥ä½œæµæµ‹è¯•åŠŸèƒ½
- [ ] æ‰§è¡Œæ—¥å¿—å¯è§†åŒ–
- [ ] ç‰ˆæœ¬æ§åˆ¶
- [ ] é¢„è®¾æ¨¡æ¿åº“

---

## å…«ã€ä¸ç°æœ‰ç³»ç»Ÿçš„å…³ç³»

### 8.1 å…¼å®¹ç­–ç•¥

| ç°æœ‰ç»„ä»¶ | æ–°ç»„ä»¶ | å…³ç³» |
|---------|--------|------|
| AutomationRule | Workflow | å¹¶å­˜ï¼Œé€æ­¥è¿ç§» |
| RuleEngine | WorkflowEngine | å¹¶å­˜ï¼Œå…±äº«å¤„ç†å™¨ |
| AutomationLog | WorkflowExecution | æ–°å¢ï¼Œæ›´è¯¦ç»† |

### 8.2 è¿ç§»è·¯å¾„

1. **çŸ­æœŸ**ï¼šæ–°çš„å¯è§†åŒ–å·¥ä½œæµä¸ç°æœ‰è§„åˆ™ç³»ç»Ÿå¹¶å­˜
2. **ä¸­æœŸ**ï¼šæä¾›è¿ç§»å·¥å…·ï¼Œå°† AutomationRule è½¬æ¢ä¸º Workflow
3. **é•¿æœŸ**ï¼šåºŸå¼ƒæ—§çš„è§„åˆ™ç¼–è¾‘å™¨ï¼Œç»Ÿä¸€ä½¿ç”¨å¯è§†åŒ–å·¥ä½œæµ

---

## ä¹ã€æ€»ç»“

é£ä¹¦é£æ ¼çš„å·¥ä½œæµè®¾è®¡å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ç›´è§‚å¯è§†åŒ–**ï¼šç”»å¸ƒå¼ç¼–è¾‘å™¨ï¼Œæ‰€è§å³æ‰€å¾—
2. **çµæ´»çš„åˆ†æ”¯**ï¼šæ”¯æŒæ¡ä»¶åˆ†æ”¯ã€å¤šåˆ†æ”¯ã€å¹¶è¡Œæ‰§è¡Œ
3. **å¼ºå¤§çš„æ‰©å±•æ€§**ï¼šèŠ‚ç‚¹ç±»å‹å¯åŠ¨æ€æ·»åŠ 
4. **å®Œæ•´çš„æ—¥å¿—**ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œéƒ½æœ‰è¯¦ç»†è®°å½•
5. **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒå›æ»šå’Œå†å²æŸ¥çœ‹

è¿™ä¸ªè®¾è®¡å°† TalentMail çš„è‡ªåŠ¨åŒ–èƒ½åŠ›æå‡åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ï¼Œè®©ç®¡ç†å‘˜èƒ½å¤Ÿåƒæ­ç§¯æœ¨ä¸€æ ·æ„å»ºå¤æ‚çš„é‚®ä»¶è‡ªåŠ¨åŒ–æµç¨‹ï¼