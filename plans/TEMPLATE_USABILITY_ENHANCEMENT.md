# TalentMail 模板易用性优化方案

## 背景
当前的邮件模板系统虽然功能完整，但主要面向管理员进行模板管理。对于普通用户（如财务、HR、客服），需要一种更简单的方式来使用预设模板发送邮件。

## 目标
1. 让非技术人员可以**一键选择预设场景**发送邮件
2. 无需理解变量语法，只需填写必要信息
3. 支持按部门/场景分类模板

---

## 功能设计

### 1. 快速发送模板邮件

#### 1.1 用户流程
```
用户点击"新邮件" → 选择"使用模板" → 
选择场景分类（财务/HR/客服/...）→ 
选择具体模板 → 填写变量表单 → 预览 → 发送
```

#### 1.2 界面设计
```
┌─────────────────────────────────────────────────────────────────────┐
│ 使用模板发送邮件                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  选择场景分类:                                                       │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                   │
│  │ 💰 财务 │ │ 👥 HR   │ │ 📞 客服 │ │ 📢 营销 │                   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘                   │
│                                                                     │
│  选择模板:                                                          │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 📄 发票通知                                                  │   │
│  │    向客户发送发票信息                                         │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 💳 付款提醒                                                  │   │
│  │    提醒客户付款                                              │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ ✅ 付款确认                                                  │   │
│  │    确认收到付款                                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  填写信息:                                                          │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 收件人邮箱 *                                                 │   │
│  │ [ customer@example.com                              ]       │   │
│  │                                                              │   │
│  │ 客户名称 *                                                   │   │
│  │ [ 张三                                              ]       │   │
│  │                                                              │   │
│  │ 发票金额 *                                                   │   │
│  │ [ ¥1,234.56                                         ]       │   │
│  │                                                              │   │
│  │ 发票编号                                                     │   │
│  │ [ INV-2024-001                                      ]       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [预览邮件]                                        [发送]           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 2. 预设场景模板

#### 2.1 财务模板
| 模板代码 | 模板名称 | 用途 |
|---------|---------|------|
| `finance_invoice` | 发票通知 | 向客户发送发票信息 |
| `finance_payment_reminder` | 付款提醒 | 提醒客户付款 |
| `finance_payment_confirm` | 付款确认 | 确认收到付款 |
| `finance_refund` | 退款通知 | 通知客户退款处理 |
| `finance_expense_approved` | 报销审批通过 | 通知员工报销已审批 |

#### 2.2 HR 模板
| 模板代码 | 模板名称 | 用途 |
|---------|---------|------|
| `hr_offer_letter` | 录用通知 | 向候选人发送录用通知 |
| `hr_onboarding` | 入职欢迎 | 新员工入职欢迎邮件 |
| `hr_interview_invite` | 面试邀请 | 邀请候选人面试 |
| `hr_birthday_wishes` | 生日祝福 | 员工生日祝福 |
| `hr_leave_approved` | 请假审批 | 通知员工请假已审批 |

#### 2.3 客服模板
| 模板代码 | 模板名称 | 用途 |
|---------|---------|------|
| `cs_ticket_received` | 工单已收到 | 确认收到客户工单 |
| `cs_ticket_resolved` | 工单已解决 | 通知客户问题已解决 |
| `cs_follow_up` | 跟进回访 | 跟进客户满意度 |
| `cs_faq_answer` | 常见问题解答 | 回复常见问题 |

#### 2.4 营销模板
| 模板代码 | 模板名称 | 用途 |
|---------|---------|------|
| `marketing_newsletter` | 电子报 | 定期资讯推送 |
| `marketing_promotion` | 促销通知 | 促销活动通知 |
| `marketing_event_invite` | 活动邀请 | 邀请参加活动 |

---

## 实现方案

### 数据库变更

1. 扩展 `template_metadata` 表添加业务分类
2. 新增用户可用模板关联（可选，用于权限控制）

```sql
-- 添加业务分类字段（更细化的分类）
ALTER TABLE template_metadata ADD COLUMN business_category VARCHAR(50);
-- 可选值: finance, hr, customer_service, marketing, sales, operations

-- 添加显示优先级
ALTER TABLE template_metadata ADD COLUMN display_priority INT DEFAULT 0;

-- 添加用户可见性
ALTER TABLE template_metadata ADD COLUMN is_user_visible BOOLEAN DEFAULT FALSE;
-- TRUE = 普通用户可在"使用模板"中选择
-- FALSE = 仅管理员可见（系统邮件）
```

### 后端 API

1. **GET /api/templates/quick-send**
   - 返回用户可用的快速发送模板
   - 按 business_category 分组

2. **POST /api/templates/quick-send**
   - 使用模板发送邮件
   - 参数: template_code, to_email, variables

### 前端组件

1. **TemplateQuickSend.vue**
   - 场景选择器
   - 模板列表
   - 动态表单生成
   - 预览功能
   - 发送功能

2. **在 ComposeModal 中集成**
   - 添加"使用模板"按钮
   - 打开 TemplateQuickSend 弹窗

---

## 开发计划

### Phase 1: 数据库和后端 (1天)
- [ ] 创建数据库迁移
- [ ] 扩展 template_metadata 模型
- [ ] 实现快速发送 API
- [ ] 添加预设模板数据

### Phase 2: 前端实现 (1天)
- [ ] 创建 TemplateQuickSend.vue 组件
- [ ] 实现场景选择器
- [ ] 实现动态表单生成
- [ ] 实现预览功能
- [ ] 集成到 ComposeModal

### Phase 3: 预设模板内容 (0.5天)
- [ ] 创建财务模板内容
- [ ] 创建 HR 模板内容
- [ ] 创建客服模板内容
- [ ] 创建营销模板内容

### Phase 4: 测试和优化 (0.5天)
- [ ] 端到端测试
- [ ] 用户体验优化
- [ ] 文档更新

---

## 实现优先级

**高优先级:**
- 快速发送模板 API
- TemplateQuickSend 组件
- 财务和 HR 模板

**中优先级:**
- 客服和营销模板
- 权限控制

**低优先级:**
- 模板收藏功能
- 发送历史记录
- 模板使用统计